# 🔐 Secure Video Streaming - Hybrid Cryptosystem Demo

Đây là một hệ thống demo mã hóa video sử dụng **kết hợp Chaotic keystream và AES-256-GCM** nhằm nâng cao tính bảo mật và xác thực khi truyền tải nội dung đa phương tiện (video). Client có thể giải mã và phát video ngay trong trình duyệt bằng WebCrypto API và WebAssembly (WASM).

## 🎯 Mục tiêu

* Mã hóa video sử dụng `Chaotic keystream XOR` và `AES-256-GCM`
* Cung cấp key từ server Flask qua API giả lập DRM
* Giải mã tại client bằng `crypto.subtle` và WASM để phát lại video
* Trình diễn tính khả thi của phương pháp bảo mật kết hợp (Hybrid Cryptography)

---

## 📁 Cấu trúc thư mục

```
secure_video_streamming/
├─ ChaoticCryptology/            # C++ library & build config
│   ├─ include/
│   ├─ src/
│   │   ├─ chaotic.cpp
│   │   ├─ crypto.cpp
│   │   └─ main.cpp
│   └─ output/
│       ├─ Chaotic_Cryptology.dll
│       └─ Chaotic_Cryptology.lib
├─ scripts/                      # Utility scripts (Python wrappers)
│   └─ encrypt_video.py           # Encrypt a single file via DLL/WASM
├─ attacker_sniffer.py           # MITM/sniffer simulation
├─ requirements.txt              # Python deps (Flask, cryptography if needed)
├─ static/                       # All client-side assets
│   ├─ js/
│   │   └── script.js            # Your HLS-like decrypt & append logic
│   ├─ wasm/
│   │   ├─ chaotic_wasm.js       # Emscripten JS wrapper
│   │   └─ chaotic_wasm.wasm     # WebAssembly binary
│   ├─ keys/
│   │   └─ sample1.key           # Generated by encrypt_segments.py
│   ├─ encrypted_segments/
│   │   └─ sample1.enc                 # Encrypted segment files
│   └─ video/
│       └─ sample1.mp4            # Original video (for segmenting)
├─ templates/
│   └─ index.html                # Demo HTML page
└─ server.py                 # Django/Flask streaming server
```

---

## 🔐 Quy trình mã hóa

1. Tạo keystream bằng Logistic Map:

   ```
   xₙ₊₁ = r * xₙ * (1 - xₙ)
   ```

   với seed = 0.5, r = 3.9
2. XOR dữ liệu video với keystream
3. Mã hóa kết quả bằng AES-256-GCM
4. Xuất ra `[IV || TAG || CIPHERTEXT]` vào file `.enc`

👉 Thực hiện bằng:

```bash
python encrypt_video.py input.mp4 segment/sample1.enc
```

---

## 🔓 Quy trình giải mã tại client

1. Tải key từ:

   ```
   GET /get_key/<video_id>?token=<your_token>
   ```
2. Tải video đã mã hóa:

   ```
   GET /segment/<video_id>.enc
   ```
3. Giải mã AES-GCM bằng WebCrypto:

   ```js
   crypto.subtle.decrypt({ name: 'AES-GCM', iv, tagLength: 128 }, aesKey, data)
   ```
4. Sinh lại keystream chaotic và XOR với kết quả giải mã
5. Tạo `Blob` và phát video bằng HTML5 `<video>`

---

## 🗂️ Luồng hoạt động của server

```plaintext
Client                          Server (Flask)
  |                                  |
  | GET /                            |
  |--------------------------------->|  Trả về index.html
  |                                  |
  | GET /static/js/script.js        |
  |--------------------------------->|  Trả về script.js
  |                                  |
  | GET /static/wasm/chaotic_wasm.js |
  |--------------------------------->|  Trả về chaotic_wasm.js
  |                                  |
  | GET /get_key/sample1?token=abc123|
  |--------------------------------->|  Trả về JSON { key_b64 }
  |                                  |
  | GET /segment/sample1.enc         |
  |--------------------------------->|  Trả về file .enc
  |                                  |
  | (Client decrypt & play)          |
```

---

## ▶️ Chạy thử demo

1. Cài thư viện:

   ```bash
   pip install flask
   ```
2. Khởi động server:

   ```bash
   python server.py
   ```
3. Truy cập: [http://127.0.0.1:9000](http://127.0.0.1:9000)

---

## ⚙️ Biên dịch WASM từ chaotic\_xor.cpp

Yêu cầu: [Emscripten SDK](https://emscripten.org/docs/getting_started/downloads.html)

```bash
emcc chaotic_xor.cpp -O3 \
  -s MODULARIZE=1 -s EXPORT_NAME="ChaoticModule" \
  -s EXPORTED_FUNCTIONS="['_generate_chaotic_keystream','_free_buffer']" \
  -s EXPORTED_RUNTIME_METHODS="['cwrap','HEAPU8']" \
  -o chaotic_wasm.js
```

> Copy `chaotic_wasm.js` & `chaotic_wasm.wasm` vào `static/wasm/`

---

## 🧑‍💻 Tác giả

Nhóm 23520564 - 23520648 - 23520394
Môn học: **Cryptography and Security**
